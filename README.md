# TeleMonitor AI

Automated monitoring system for Telegram chats and channels with AI-powered analytics using ZhipuAI GLM-4.

## Features

- **Userbot Integration**: MTProto-based access to Telegram content
- **Real-time Monitoring**: Continuous message ingestion from monitored chats
- **Trigger Alerts**: Instant notifications based on keyword detection
- **AI Analytics**: Daily intelligence reports generated by GLM-4
- **Catch-up Mechanism**: Automatic recovery of missed messages during downtime
- **ChatOps Interface**: Full system control via Telegram bot commands

## Technology Stack

- **Language**: Go 1.22+
- **Database**: PostgreSQL 16
- **Userbot**: gotd (MTProto)
- **Bot Interface**: telebot v3
- **AI Provider**: ZhipuAI GLM-4
- **Infrastructure**: Docker & Docker Compose

## Quick Start

### Prerequisites

- Docker and Docker Compose
- Telegram API credentials (app_id and app_hash)
- Telegram Bot Token
- ZhipuAI API Key

### Installation

1. Clone the repository:
```bash
git clone <repository-url>
cd asist_app
```

2. Copy environment configuration:
```bash
cp .env.example .env
```

3. Edit `.env` and add your credentials:
- `TG_APP_ID` and `TG_APP_HASH` from https://my.telegram.org
- `TG_BOT_TOKEN` from @BotFather
- `TG_ADMIN_ID` - your Telegram user ID
- `ZHIPU_API_KEY` from ZhipuAI dashboard

4. Start the services:
```bash
docker-compose up -d
```

5. Check logs:
```bash
docker-compose logs -f telemonitor
```

## Configuration

### config.yaml (Optional)

Create a `config.yaml` file for additional configuration:

```yaml
telegram:
  app_id: 12345
  app_hash: "your_hash"
  bot_token: "your_token"
  admin_id: 999999
  device_model: "Desktop"
  system_version: "Windows 10"
  app_version: "4.9.0"

ai:
  zhipu_api_key: "your_key"
  model: "glm-4"
  temperature: 0.3
  max_tokens: 2000

scheduler:
  report_time: "08:00"
  raw_messages_retention_days: 7

rate_limiting:
  min_delay: 1000
  max_delay: 5000
  transcriptions_per_minute: 10
```

Environment variables take precedence over `config.yaml`.

## Bot Commands

### System Management
- `/start` - Verify access
- `/status` - System health status
- `/login` - Authenticate userbot
- `/logout` - Terminate userbot session

### Monitoring Management
- `/chats` - List monitored chats
- `/add_chat <link|username>` - Add chat to monitoring
- `/list_dialogs [n]` - Show recent dialogs
- `/del_chat <chat_id>` - Remove chat

### Trigger Management
- `/triggers` - List active triggers
- `/add_trigger <phrase> [level]` - Add keyword trigger
- `/del_trigger <id>` - Remove trigger

### Analytics
- `/report_now [chat_id]` - Generate immediate report
- `/ask <query>` - Search historical reports

## Database Schema

The system uses 5 main tables:

1. **session_storage** - Userbot session persistence
2. **monitored_chats** - List of monitored sources
3. **raw_messages** - Message archive (7-day retention)
4. **triggers** - Keyword alert definitions
5. **daily_reports** - AI-generated intelligence reports

## Development

### Project Structure

```
.
├── cmd/
│   └── telemonitor/      # Application entry point
├── internal/
│   ├── config/           # Configuration management
│   ├── database/         # Database layer
│   │   ├── migrations/   # SQL migrations
│   │   └── repository/   # Data access layer
│   ├── userbot/          # Userbot client
│   ├── bot/              # Bot interface
│   ├── ingestion/        # Message collection
│   ├── reactor/          # Trigger processing
│   └── intelligence/     # AI analytics
├── docker-compose.yml
├── Dockerfile
└── README.md
```

### Running Locally

1. Install Go 1.22+
2. Install PostgreSQL 16
3. Run migrations manually or use the app
4. Build and run:

```bash
go mod download
go build -o telemonitor ./cmd/telemonitor
./telemonitor
```

## Security

- **Read-only Mode**: Userbot never writes to monitored chats
- **Access Control**: Single admin whitelist
- **Anti-Detection**: Client masquerading as official Telegram Desktop
- **Rate Limiting**: Human-like delays on all operations

## License

See LICENSE file for details.

## Support

For issues and questions, please refer to the technical specification document.
